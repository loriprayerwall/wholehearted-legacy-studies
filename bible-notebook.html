<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wholehearted Legacy - Bible Study Notebook</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Georgia', 'Times New Roman', serif;
      background: #f4f1ea;
      color: #2c2c2c;
    }
    .no-print { /* class used in original notebook for non-print elements */ }
  </style>
</head>
<body>
  <div style="max-width:1200px; margin:0 auto;">
    <button onclick="window.location.href='https://www.wholeheartedlegacy.org/new-home'" style="margin-bottom:1.5rem; padding:0.6rem 1.2rem; border-radius:999px; border:none; background:#8b7355; color:#fff; font-weight:600; cursor:pointer;">
      ‚Üê Back to Wholehearted Legacy
    </button>
    <div id="bible-notebook-wrapper" style="margin-top:2rem;"><div class="h-full w-full overflow-auto" id="app"><!-- Header -->
<header class="sticky top-0 z-10 shadow-sm no-print">
<div class="max-w-6xl mx-auto px-4 py-6">
<h1 class="text-center font-bold mb-2" id="notebook-title">Bible Study Notebook</h1>
<p class="text-center" id="welcome-message">Seek first the kingdom of God and His righteousness</p>
</div>
</header><!-- Main Content -->
<main class="max-w-6xl mx-auto px-4 py-8"><!-- Navigation Tabs -->
<div class="flex flex-wrap gap-2 mb-6 justify-center no-print"><button class="nav-tab px-6 py-3 rounded-lg font-semibold transition-colors" data-view="entries"> üìù My Entries </button> <button class="nav-tab px-6 py-3 rounded-lg font-semibold transition-colors" data-view="reading"> üìñ Daily Reading </button> <button class="nav-tab px-6 py-3 rounded-lg font-semibold transition-colors" data-view="books"> üìö Bible Books </button>
</div><!-- Entries View -->
<div id="entries-view"><!-- Action Buttons -->
<div class="flex flex-wrap gap-3 mb-8 justify-center no-print"><button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-study-note"> ‚úèÔ∏è Study Note </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-reflection"> üí≠ Reflection </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-prayer"> üôè Prayer </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-sermon-notes"> üìñ Sermon Notes </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-soap"> üßº SOAP Study </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-verse-mapping"> üó∫Ô∏è Verse Mapping </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-chapter"> üìö Chapter/Book </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-word-study"> üîç Word Study </button> <button class="px-6 py-3 rounded-lg font-semibold transition-colors" id="btn-character"> üë§ Character Study </button>
</div>
</div><!-- Daily Reading View -->
<div class="hidden" id="reading-view"><!-- Reading Stats -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8" id="reading-stats"><!-- Stats will be rendered here -->
</div><!-- Add Reading Button -->
<div class="text-center mb-6 no-print"><button class="px-8 py-4 rounded-lg font-bold transition-colors" id="btn-add-reading"> ‚úÖ Mark Today's Reading Complete </button>
</div><!-- Reading History -->
<div id="reading-history">
<h3 class="font-bold mb-4 text-center">Reading History</h3>
<div class="space-y-3" id="reading-list"><!-- Reading entries will be shown here -->
</div>
<div class="hidden text-center py-8 opacity-70" id="reading-empty">
<p>No reading history yet. Start your daily Bible reading journey today!</p>
</div>
</div>
</div><!-- Books View (Hidden by default) -->
<div class="hidden" id="books-view"><!-- Testament Filter -->
<div class="flex gap-3 mb-6 justify-center no-print"><button class="testament-tab px-6 py-3 rounded-lg font-semibold transition-colors" data-testament="old"> Old Testament </button> <button class="testament-tab px-6 py-3 rounded-lg font-semibold transition-colors" data-testament="new"> New Testament </button>
</div><!-- Books Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8" id="books-grid"><!-- Books will be dynamically added here -->
</div><!-- Book Detail View (Hidden by default) -->
<div class="hidden" id="book-detail"><button class="mb-4 px-4 py-2 rounded-lg font-medium transition-colors no-print" id="back-to-books"> ‚Üê Back to Books </button>
<div class="rounded-lg shadow-lg p-6 mb-6" id="book-detail-content"><!-- Book details will be dynamically added here -->
</div><!-- Study Tools for Book -->
<div class="mb-6 no-print">
<h3 class="font-bold mb-4 text-center" id="book-tools-title">Study Tools</h3>
<div class="flex flex-wrap gap-3 justify-center"><button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="study"> ‚úèÔ∏è Study Note </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="reflection"> üí≠ Reflection </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="prayer"> üôè Prayer </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="soap"> üßº SOAP Study </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="verse"> üó∫Ô∏è Verse Mapping </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="chapter"> üìö Chapter Study </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="word"> üîç Word Study </button> <button class="book-tool-btn px-5 py-2 rounded-lg font-medium transition-colors" data-tool="character"> üë§ Character Study </button>
</div>
</div><!-- Entries for this book -->
<div id="book-entries">
<h3 class="font-bold mb-4" id="book-entries-title">My Studies</h3>
<div class="space-y-4" id="book-entries-container"><!-- Book-specific entries will be shown here -->
</div>
<div class="hidden text-center py-8 opacity-70 no-print" id="book-entries-empty">
<p>No studies yet for this book</p>
</div>
</div>
</div>
</div><!-- Search Bar and Backup Options -->
<div class="mb-6 max-w-2xl mx-auto no-print">
<div class="relative mb-4"><input class="w-full px-4 py-3 pr-10 rounded-lg border-2 focus:outline-none" id="search-input" placeholder="Search across all entries..." type="text"/> <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xl">üîç</span>
</div><!-- Backup Options -->
<div class="flex flex-wrap gap-3 justify-center"><button class="backup-btn px-4 py-2 rounded-lg font-medium transition-colors" id="btn-copy-notes"> üìã Copy All Notes </button> <button class="backup-btn px-4 py-2 rounded-lg font-medium transition-colors" id="btn-download-pdf"> üíæ Download PDF </button> <button class="backup-btn px-4 py-2 rounded-lg font-medium transition-colors" id="btn-print"> üñ®Ô∏è Print Notes </button>
</div>
</div><!-- Filter Tabs -->
<div class="flex flex-wrap gap-2 mb-6 justify-center no-print"><button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="all"> All Entries </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="favorites"> ‚≠ê Favorites </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="study"> Study Notes </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="reflection"> Reflections </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="prayer"> Prayers </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="sermon"> Sermons </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="soap"> SOAP </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="verse"> Verse Mapping </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="chapter"> Chapters </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="word"> Word Studies </button> <button class="filter-tab px-4 py-2 rounded-full font-medium transition-colors" data-filter="character"> Character Studies </button>
</div><!-- Entry Form (Hidden by default) -->
<div class="hidden rounded-lg shadow-lg p-6 mb-8 fade-in no-print" id="entry-form">
<div class="flex justify-between items-center mb-4">
<h2 class="font-bold" id="form-title">New Entry</h2><button class="px-4 py-2 rounded-lg font-medium transition-colors" id="btn-cancel"> Cancel </button>
</div>
<form id="note-form"><!-- Basic Entry Form (Study, Reflection, Prayer, Sermon) -->
<div id="basic-form">
<div class="mb-4"><label class="block font-medium mb-2" for="entry-title">Title</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="entry-title" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="scripture-ref">Scripture Reference</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="scripture-ref" placeholder="e.g., John 3:16" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="entry-content">Content</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="entry-content" rows="8"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="entry-tags">Tags (comma-separated)</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="entry-tags" placeholder="faith, hope, love" type="text"/>
</div>
</div><!-- SOAP Form -->
<div class="hidden" id="soap-form">
<div class="mb-4"><label class="block font-medium mb-2" for="soap-title">Title</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="soap-title" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="soap-scripture">üìñ Scripture</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="soap-scripture" placeholder="e.g., Psalm 23:1-6" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="soap-observation">üëÅÔ∏è Observation (What do I see?)</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="soap-observation" rows="4"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="soap-application">üí° Application (How does it apply to me?)</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="soap-application" rows="4"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="soap-prayer">üôè Prayer (What should I pray?)</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="soap-prayer" rows="4"></textarea>
</div>
</div><!-- Verse Mapping Form -->
<div class="hidden" id="verse-form">
<div class="mb-4"><label class="block font-medium mb-2" for="verse-reference">Verse Reference</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="verse-reference" placeholder="e.g., Romans 8:28" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="verse-text">Verse Text</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="verse-text" rows="3"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="verse-mapping">Mapping/Connections</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="verse-mapping" placeholder="Map themes, connections, related verses, theological insights..." rows="6"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="verse-tags">Tags</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="verse-tags" placeholder="grace, salvation, promise" type="text"/>
</div>
</div><!-- Chapter/Book Form -->
<div class="hidden" id="chapter-form">
<div class="mb-4"><label class="block font-medium mb-2" for="book-chapter">Book &amp; Chapter</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="book-chapter" placeholder="e.g., Genesis 1" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="chapter-summary">Chapter Summary</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="chapter-summary" rows="6"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="key-verses">Key Verses</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="key-verses" placeholder="List key verses and their significance..." rows="3"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="chapter-tags">Tags</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="chapter-tags" placeholder="creation, covenant, prophecy" type="text"/>
</div>
</div><!-- Word Study Form -->
<div class="hidden" id="word-form">
<div class="mb-4"><label class="block font-medium mb-2" for="word">Word/Phrase</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="word" placeholder="e.g., Agape" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="hebrew-greek">Hebrew/Greek</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="hebrew-greek" placeholder="e.g., ·ºÄŒ≥Œ¨œÄŒ∑ (agapƒì)" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="definition">Definition &amp; Meaning</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="definition" rows="4"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="cross-references">Cross References &amp; Usage</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="cross-references" placeholder="List passages where this word appears and its context..." rows="4"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="word-tags">Tags</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="word-tags" placeholder="love, Greek, New Testament" type="text"/>
</div>
</div><!-- Character Study Form -->
<div class="hidden" id="character-form">
<div class="mb-4"><label class="block font-medium mb-2" for="character-name">Character Name</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="character-name" placeholder="e.g., David, Ruth, Peter" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="character-scripture">Primary Scripture References</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="character-scripture" placeholder="e.g., 1 Samuel 16-31, 2 Samuel" type="text"/>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="character-background">Background &amp; Context</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="character-background" placeholder="Who are they? Where are they from? What's their role?" rows="3"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="character-traits">Character Traits &amp; Qualities</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="character-traits" placeholder="Strengths, weaknesses, personality..." rows="3"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="key-events">Key Events &amp; Decisions</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="key-events" placeholder="Major moments in their life..." rows="4"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="relationships">Relationships</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="relationships" placeholder="Family, friends, mentors, enemies..." rows="3"></textarea>
</div>
<div class="mb-4"><label class="block font-medium mb-2" for="spiritual-lessons">Spiritual Lessons &amp; Applications</label> <textarea class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80 resize-vertical" id="spiritual-lessons" placeholder="What can we learn from this person's life?" rows="4"></textarea>
</div>
<div class="mb-6"><label class="block font-medium mb-2" for="character-tags">Tags</label> <input class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80" id="character-tags" placeholder="faith, obedience, courage" type="text"/>
</div>
</div><button class="w-full py-3 rounded-lg font-semibold transition-colors" id="btn-save" type="submit"> Save Entry </button>
</form>
</div><!-- Entries List -->
<div class="space-y-4" id="entries-container"><!-- Entries will be dynamically added here -->
</div><!-- Empty State -->
<div class="text-center py-12 no-print" id="empty-state">
<div class="mb-4 opacity-50">
      üìù
     </div>
<p class="font-medium mb-2">No entries yet</p>
<p class="opacity-70">Start your Bible study journey by creating your first entry</p>
</div>
</main>
      </div>
    </div>

    <script>
      const notebookDefaultConfig = {
        background_color: "#f8f7f4",
        surface_color: "#ffffff",
        text_color: "#2c2c2c",
        primary_color: "#8b6f47",
        secondary_color: "#a89080",
        notebook_title: "Bible Study Notebook",
        welcome_message: "Seek first the kingdom of God and His righteousness",
        font_family: "Georgia",
        font_size: 16
      };
      // ‚Ä¶keep the rest of your script exactly as it already is‚Ä¶
    let notebookCurrentConfig = { ...notebookDefaultConfig };
    let currentFilter = 'all';
    let currentEntryType = '';
    let allEntries = [];
    let searchQuery = '';
    let currentView = 'entries';
    let currentTestament = 'old';
    let currentBook = null;

    // Bible books data
    const bibleBooks = {
      old: [
        { 
          name: "Genesis", 
          chapters: 50, 
          category: "Law", 
          description: "The book of beginnings - creation, fall, and the patriarchs",
          who: "Written by Moses. Key figures: Adam, Noah, Abraham, Isaac, Jacob, Joseph",
          what: "Origins of the world, humanity, sin, and God's covenant with His people",
          when: "Events: Creation to c. 1800s BC. Written: c. 1445-1405 BC during the Exodus",
          where: "Garden of Eden, Mesopotamia, Canaan, Egypt"
        },
        { 
          name: "Exodus", 
          chapters: 40, 
          category: "Law", 
          description: "Israel's deliverance from Egypt and the giving of the Law",
          who: "Written by Moses. Key figures: Moses, Aaron, Pharaoh, Joshua",
          what: "Deliverance from slavery, the Ten Commandments, and the Tabernacle",
          when: "Events: c. 1446-1406 BC. Written: c. 1445-1405 BC",
          where: "Egypt, Red Sea, Mount Sinai, wilderness"
        },
        { 
          name: "Leviticus", 
          chapters: 27, 
          category: "Law", 
          description: "Laws for worship, sacrifice, and holy living",
          who: "Written by Moses. Addressed to priests and all Israel",
          what: "Instructions for sacrifices, festivals, and living as God's holy people",
          when: "Events and writing: c. 1445 BC at Mount Sinai",
          where: "Mount Sinai and the Tabernacle"
        },
        { 
          name: "Numbers", 
          chapters: 36, 
          category: "Law", 
          description: "Israel's wilderness journey and preparation for Canaan",
          who: "Written by Moses. Chronicles the Israelites' wilderness generation",
          what: "Census, rebellion, wandering, and preparation for the Promised Land",
          when: "Events: c. 1444-1406 BC. Written: c. 1405 BC",
          where: "Sinai wilderness to the plains of Moab"
        },
        { 
          name: "Deuteronomy", 
          chapters: 34, 
          category: "Law", 
          description: "Moses' final words and renewal of the covenant",
          who: "Written by Moses (with Joshua's epilogue). Addressed to new generation",
          what: "Retelling of the Law, covenant renewal, and blessings/curses",
          when: "Events and writing: c. 1406 BC, just before entering Canaan",
          where: "Plains of Moab, east of the Jordan River"
        },
        { 
          name: "Joshua", 
          chapters: 24, 
          category: "History", 
          description: "Conquest and settlement of the Promised Land",
          who: "Written by Joshua. Key figures: Joshua, Caleb, Rahab",
          what: "Conquest of Canaan, division of the land among twelve tribes",
          when: "Events: c. 1406-1375 BC. Written: c. 1375-1050 BC",
          where: "Canaan (Promised Land), especially Jericho and Ai"
        },
        { 
          name: "Judges", 
          chapters: 21, 
          category: "History", 
          description: "Cycles of sin, oppression, and deliverance",
          who: "Author uncertain (possibly Samuel). Key figures: Deborah, Gideon, Samson",
          what: "Repeated cycles of rebellion, judgment, repentance, and deliverance",
          when: "Events: c. 1375-1050 BC. Written: c. 1043-1004 BC",
          where: "Throughout the land of Israel"
        },
        { 
          name: "Ruth", 
          chapters: 4, 
          category: "History", 
          description: "A story of loyalty, love, and redemption",
          who: "Author uncertain (possibly Samuel). Key figures: Ruth, Naomi, Boaz",
          what: "A Moabite woman's loyalty and God's providential redemption",
          when: "Events: c. 1100s BC (time of judges). Written: c. 1010-970 BC",
          where: "Moab and Bethlehem in Judah"
        },
        { 
          name: "1 Samuel", 
          chapters: 31, 
          category: "History", 
          description: "Transition from judges to monarchy - Samuel, Saul, and David",
          who: "Written by Samuel, Nathan, and Gad. Key figures: Samuel, Saul, David",
          what: "Israel's demand for a king, Saul's reign, and David's rise",
          when: "Events: c. 1105-1011 BC. Written: c. 930-722 BC",
          where: "Throughout Israel, especially Shiloh, Ramah, and Gibeah"
        },
        { 
          name: "2 Samuel", 
          chapters: 24, 
          category: "History", 
          description: "David's reign as king of Israel",
          who: "Written by Nathan and Gad. Chronicles King David",
          what: "David's successes, failures, and establishment of Jerusalem",
          when: "Events: c. 1011-971 BC. Written: c. 930-722 BC",
          where: "Primarily Jerusalem, David's capital city"
        },
        { 
          name: "1 Kings", 
          chapters: 22, 
          category: "History", 
          description: "Solomon's reign and the divided kingdom",
          who: "Author uncertain (possibly Jeremiah). Chronicles kings of Israel and Judah",
          what: "Solomon's temple, kingdom division, and prophets Elijah",
          when: "Events: c. 971-853 BC. Written: c. 560 BC",
          where: "United then divided kingdom: Israel (north) and Judah (south)"
        },
        { 
          name: "2 Kings", 
          chapters: 25, 
          category: "History", 
          description: "Kings of Israel and Judah until exile",
          who: "Author uncertain (possibly Jeremiah). Chronicles decline and exile",
          what: "Continuing rebellion, prophetic warnings, fall of both kingdoms",
          when: "Events: c. 853-561 BC. Written: c. 560 BC",
          where: "Israel and Judah, ending in Babylonian exile"
        },
        { 
          name: "1 Chronicles", 
          chapters: 29, 
          category: "History", 
          description: "Israel's history from God's perspective",
          who: "Written by Ezra. Genealogies from Adam through David's reign",
          what: "Priestly perspective on Israel's history and David's preparations for temple",
          when: "Events: Creation to c. 971 BC. Written: c. 450-425 BC",
          where: "Jerusalem and the temple at the center"
        },
        { 
          name: "2 Chronicles", 
          chapters: 36, 
          category: "History", 
          description: "Judah's kings and temple worship",
          who: "Written by Ezra. Focus on Judah's kings and temple",
          what: "Solomon's temple, spiritual reforms and failures, exile and hope",
          when: "Events: c. 971-538 BC. Written: c. 450-425 BC",
          where: "Judah and Jerusalem, centered on the temple"
        },
        { 
          name: "Ezra", 
          chapters: 10, 
          category: "History", 
          description: "Return from exile and rebuilding the temple",
          who: "Written by Ezra. Key figures: Zerubbabel, Ezra",
          what: "Two returns from exile, rebuilding temple, spiritual renewal",
          when: "Events: c. 538-457 BC. Written: c. 450-425 BC",
          where: "Jerusalem and the rebuilt temple"
        },
        { 
          name: "Nehemiah", 
          chapters: 13, 
          category: "History", 
          description: "Rebuilding Jerusalem's walls and spiritual renewal",
          who: "Written by Nehemiah (with help from Ezra). Governor of Judah",
          what: "Rebuilding walls, social reforms, and covenant renewal",
          when: "Events: c. 445-425 BC. Written: c. 425 BC",
          where: "Jerusalem, rebuilding its walls and community"
        },
        { 
          name: "Esther", 
          chapters: 10, 
          category: "History", 
          description: "God's providence in protecting His people",
          who: "Author uncertain (possibly Mordecai). Key figures: Esther, Mordecai, Haman",
          what: "Jewish deliverance from genocide plot in Persia",
          when: "Events: c. 483-473 BC. Written: c. 470-450 BC",
          where: "Susa, capital of Persian Empire"
        },
        { 
          name: "Job", 
          chapters: 42, 
          category: "Wisdom", 
          description: "Wrestling with suffering and God's sovereignty",
          who: "Author uncertain (possibly Job, Moses, or Solomon). Key figure: Job",
          what: "Why do the righteous suffer? God's wisdom vs human understanding",
          when: "Events: Patriarchal era (c. 2000-1800 BC). Written: Date debated",
          where: "Land of Uz (possibly Edom, southeast of Israel)"
        },
        { 
          name: "Psalms", 
          chapters: 150, 
          category: "Wisdom", 
          description: "Songs of worship, lament, and praise",
          who: "Multiple authors: David (73), Asaph (12), Sons of Korah (11), others",
          what: "Songs covering every human emotion directed toward God",
          when: "Written: c. 1440-430 BC. Compiled: c. 430 BC",
          where: "Worship in Israel's temple and personal devotion"
        },
        { 
          name: "Proverbs", 
          chapters: 31, 
          category: "Wisdom", 
          description: "Wisdom for daily living and godly character",
          who: "Primarily Solomon, with contributions from wise men, Agur, and Lemuel",
          what: "Practical wisdom for relationships, work, speech, and character",
          when: "Written: c. 971-686 BC. Compiled under Hezekiah",
          where: "Israel, for teaching wisdom to all generations"
        },
        { 
          name: "Ecclesiastes", 
          chapters: 12, 
          category: "Wisdom", 
          description: "The search for meaning in life",
          who: "Written by 'the Teacher' (traditionally Solomon)",
          what: "Life's meaninglessness apart from God; fear God and keep His commands",
          when: "Written: c. 935 BC (late in Solomon's life)",
          where: "Jerusalem, reflecting on a life of wealth and wisdom"
        },
        { 
          name: "Song of Solomon", 
          chapters: 8, 
          category: "Wisdom", 
          description: "A celebration of love and devotion",
          who: "Written by Solomon. Key figures: Lover and Beloved",
          what: "Poetic celebration of marital love and devotion",
          when: "Written: c. 971-965 BC (early in Solomon's reign)",
          where: "Israel, celebrating God's gift of covenant love"
        },
        { 
          name: "Isaiah", 
          chapters: 66, 
          category: "Major Prophets", 
          description: "Judgment and hope - the coming Messiah",
          who: "Written by Isaiah. Prophet to Judah during four kings' reigns",
          what: "Judgment on sin, comfort in exile, prophecies of the Messiah",
          when: "Ministry: c. 740-681 BC. Written during this period",
          where: "Judah and Jerusalem, before the exile"
        },
        { 
          name: "Jeremiah", 
          chapters: 52, 
          category: "Major Prophets", 
          description: "Warnings of judgment and promises of restoration",
          who: "Written by Jeremiah (the 'weeping prophet'). Scribe: Baruch",
          what: "Warnings against idolatry, prophecy of 70-year exile, new covenant",
          when: "Ministry: c. 627-586 BC. Written during this period",
          where: "Judah, Jerusalem, and Egypt during the fall of Jerusalem"
        },
        { 
          name: "Lamentations", 
          chapters: 5, 
          category: "Major Prophets", 
          description: "Grief over Jerusalem's destruction",
          who: "Written by Jeremiah after Jerusalem's fall",
          what: "Five poetic laments over the destruction of Jerusalem and temple",
          when: "Written: c. 586 BC, immediately after Jerusalem's destruction",
          where: "Jerusalem, amid the ruins"
        },
        { 
          name: "Ezekiel", 
          chapters: 48, 
          category: "Major Prophets", 
          description: "Visions of God's glory and future restoration",
          who: "Written by Ezekiel, priest and prophet to the exiles",
          what: "God's glory departing and returning, valley of dry bones, new temple",
          when: "Ministry: c. 593-571 BC during exile. Written during this period",
          where: "Babylon, among the Jewish exiles by the Kebar River"
        },
        { 
          name: "Daniel", 
          chapters: 12, 
          category: "Major Prophets", 
          description: "Faithfulness in exile and apocalyptic visions",
          who: "Written by Daniel, Jewish exile in Babylonian and Persian courts",
          what: "Faithfulness in foreign culture, visions of world empires and God's kingdom",
          when: "Events and writing: c. 605-536 BC during exile",
          where: "Babylon and Persia during the exile"
        },
        { 
          name: "Hosea", 
          chapters: 14, 
          category: "Minor Prophets", 
          description: "God's unfailing love for unfaithful Israel",
          who: "Written by Hosea. His marriage mirrors God's relationship with Israel",
          what: "Israel's unfaithfulness and God's persistent, covenant love",
          when: "Ministry: c. 755-715 BC. Written during this period",
          where: "Northern Kingdom (Israel), before its fall in 722 BC"
        },
        { 
          name: "Joel", 
          chapters: 3, 
          category: "Minor Prophets", 
          description: "The Day of the Lord and outpouring of the Spirit",
          who: "Written by Joel. Prophet to Judah",
          what: "Locust plague as judgment, call to repentance, promise of the Spirit",
          when: "Date debated: possibly c. 835 BC or 597-586 BC",
          where: "Judah and Jerusalem"
        },
        { 
          name: "Amos", 
          chapters: 9, 
          category: "Minor Prophets", 
          description: "Justice and righteousness demanded",
          who: "Written by Amos, a shepherd from Tekoa called to prophesy to Israel",
          what: "Social injustice condemned, call for righteousness to flow like a river",
          when: "Ministry: c. 760-750 BC. Written during this period",
          where: "Primarily Northern Kingdom (Israel), from Judah"
        },
        { 
          name: "Obadiah", 
          chapters: 1, 
          category: "Minor Prophets", 
          description: "Judgment on Edom for pride",
          who: "Written by Obadiah (shortest OT book). Little known about him",
          what: "Judgment on Edom for violence against Judah, God's kingdom will triumph",
          when: "Date debated: c. 848 BC or 586-585 BC (after Jerusalem's fall)",
          where: "Prophecy against Edom, Judah's neighbor to the southeast"
        },
        { 
          name: "Jonah", 
          chapters: 4, 
          category: "Minor Prophets", 
          description: "God's mercy extends to all nations",
          who: "Written by/about Jonah. Prophet to Israel who fled God's call",
          what: "Reluctant prophet, God's compassion for Nineveh, missionary message",
          when: "Events: c. 785-750 BC. Written possibly later",
          where: "Israel to Nineveh (Assyria), via the Mediterranean"
        },
        { 
          name: "Micah", 
          chapters: 7, 
          category: "Minor Prophets", 
          description: "Justice, mercy, and humble walk with God",
          who: "Written by Micah. Prophet to Judah, contemporary of Isaiah",
          what: "Judgment on injustice, prophecy of Messiah from Bethlehem (5:2)",
          when: "Ministry: c. 735-700 BC. Written during this period",
          where: "Judah and Jerusalem, with prophecy about Bethlehem"
        },
        { 
          name: "Nahum", 
          chapters: 3, 
          category: "Minor Prophets", 
          description: "God's judgment on Nineveh",
          who: "Written by Nahum. Prophet announcing Nineveh's doom",
          what: "God's judgment on Assyria's capital for cruelty and pride",
          when: "Written: c. 663-612 BC, before Nineveh's fall in 612 BC",
          where: "Prophecy against Nineveh (Assyria), written from Judah"
        },
        { 
          name: "Habakkuk", 
          chapters: 3, 
          category: "Minor Prophets", 
          description: "Living by faith amid injustice",
          who: "Written by Habakkuk. Prophet wrestling with God's justice",
          what: "Why does evil prosper? The righteous will live by faith (2:4)",
          when: "Written: c. 609-605 BC, before Babylon's invasion",
          where: "Judah, watching the rise of Babylonian power"
        },
        { 
          name: "Zephaniah", 
          chapters: 3, 
          category: "Minor Prophets", 
          description: "The Day of the Lord and future hope",
          who: "Written by Zephaniah. Prophet to Judah during Josiah's reign",
          what: "Universal judgment coming, call to seek the Lord, future hope",
          when: "Ministry: c. 640-627 BC. Written during this period",
          where: "Judah and Jerusalem during King Josiah's reforms"
        },
        { 
          name: "Haggai", 
          chapters: 2, 
          category: "Minor Prophets", 
          description: "Rebuilding the temple - priorities matter",
          who: "Written by Haggai. Post-exile prophet encouraging temple rebuilding",
          what: "Rebuke for neglecting temple, call to rebuild, promise of glory",
          when: "Ministry and writing: 520 BC (four months after return)",
          where: "Jerusalem after the exile, during temple reconstruction"
        },
        { 
          name: "Zechariah", 
          chapters: 14, 
          category: "Minor Prophets", 
          description: "Visions of restoration and the coming King",
          who: "Written by Zechariah. Contemporary of Haggai, post-exile prophet",
          what: "Eight visions, messianic prophecies, future restoration of Israel",
          when: "Ministry: c. 520-480 BC. Written during this period",
          where: "Jerusalem after the exile"
        },
        { 
          name: "Malachi", 
          chapters: 4, 
          category: "Minor Prophets", 
          description: "Faithful worship and the coming messenger",
          who: "Written by Malachi (name means 'my messenger'). Last OT prophet",
          what: "Rebuke for unfaithful worship, promise of Elijah before Messiah",
          when: "Written: c. 435-425 BC, final OT book",
          where: "Jerusalem, about 100 years after return from exile"
        }
      ],
      new: [
        { 
          name: "Matthew", 
          chapters: 28, 
          category: "Gospels", 
          description: "Jesus as the promised Messiah and King",
          who: "Written by Matthew (Levi), tax collector turned apostle",
          what: "Jesus fulfills OT prophecy as Israel's King and Messiah",
          when: "Events: c. 5 BC - AD 30. Written: c. AD 50-70",
          where: "Israel - Bethlehem, Galilee, Jerusalem"
        },
        { 
          name: "Mark", 
          chapters: 16, 
          category: "Gospels", 
          description: "Jesus as the suffering Servant",
          who: "Written by John Mark, companion of Peter and Paul",
          what: "Fast-paced account of Jesus as the suffering Servant of God",
          when: "Events: c. 27-30 AD. Written: c. AD 50-60",
          where: "Galilee and Jerusalem, written for Roman audience"
        },
        { 
          name: "Luke", 
          chapters: 24, 
          category: "Gospels", 
          description: "Jesus as the Son of Man - Savior of all people",
          who: "Written by Luke, physician and companion of Paul",
          what: "Carefully researched account showing Jesus as Savior of all humanity",
          when: "Events: c. 5 BC - AD 30. Written: c. AD 60-61",
          where: "From Bethlehem to Jerusalem, written for Greek audience"
        },
        { 
          name: "John", 
          chapters: 21, 
          category: "Gospels", 
          description: "Jesus as the Son of God and eternal Word",
          who: "Written by John the apostle, 'the disciple Jesus loved'",
          what: "Theological presentation of Jesus as divine Son of God",
          when: "Events: c. 27-30 AD. Written: c. AD 85-95",
          where: "Primarily Jerusalem and Judea"
        },
        { 
          name: "Acts", 
          chapters: 28, 
          category: "History", 
          description: "The birth and growth of the early church",
          who: "Written by Luke (companion to 'Luke'). Chronicles apostles' ministry",
          what: "Holy Spirit empowers church from Jerusalem to Rome",
          when: "Events: c. AD 30-62. Written: c. AD 62",
          where: "From Jerusalem to Rome - the spread of the gospel"
        },
        { 
          name: "Romans", 
          chapters: 16, 
          category: "Paul's Letters", 
          description: "The gospel - righteousness through faith",
          who: "Written by Paul to the church in Rome",
          what: "Systematic explanation of salvation by grace through faith",
          when: "Written: c. AD 57 from Corinth",
          where: "To believers in Rome, capital of the Empire"
        },
        { 
          name: "1 Corinthians", 
          chapters: 16, 
          category: "Paul's Letters", 
          description: "Church unity and spiritual maturity",
          who: "Written by Paul to the troubled church in Corinth",
          what: "Addresses divisions, immorality, spiritual gifts, and love",
          when: "Written: c. AD 55 from Ephesus",
          where: "To the church in Corinth, a wealthy Greek port city"
        },
        { 
          name: "2 Corinthians", 
          chapters: 13, 
          category: "Paul's Letters", 
          description: "Paul's ministry and comfort in suffering",
          who: "Written by Paul, defending his apostolic ministry",
          what: "Comfort in affliction, authentic ministry, generous giving",
          when: "Written: c. AD 56 from Macedonia",
          where: "To the church in Corinth (follow-up letter)"
        },
        { 
          name: "Galatians", 
          chapters: 6, 
          category: "Paul's Letters", 
          description: "Freedom in Christ - salvation by grace",
          who: "Written by Paul to churches in Galatia region",
          what: "Defense of salvation by faith alone, not by works of the law",
          when: "Written: c. AD 49 (earliest) or AD 53-57",
          where: "To churches in Galatia (central Turkey)"
        },
        { 
          name: "Ephesians", 
          chapters: 6, 
          category: "Paul's Letters", 
          description: "Our identity and unity in Christ",
          who: "Written by Paul from prison, possibly circular letter",
          what: "Believers' position in Christ, unity of the church, spiritual warfare",
          when: "Written: c. AD 60-62 from Rome",
          where: "To the church in Ephesus (major Asian city)"
        },
        { 
          name: "Philippians", 
          chapters: 4, 
          category: "Paul's Letters", 
          description: "Joy and contentment in Christ",
          who: "Written by Paul from prison to his beloved Philippian church",
          what: "Joy in Christ despite circumstances, Christ's humility and exaltation",
          when: "Written: c. AD 61 from Rome",
          where: "To the church in Philippi (Macedonia)"
        },
        { 
          name: "Colossians", 
          chapters: 4, 
          category: "Paul's Letters", 
          description: "Christ's supremacy and sufficiency",
          who: "Written by Paul from prison, addressing false teaching",
          what: "Christ is supreme over all creation and sufficient for salvation",
          when: "Written: c. AD 60-62 from Rome",
          where: "To the church in Colossae (Asia Minor)"
        },
        { 
          name: "1 Thessalonians", 
          chapters: 5, 
          category: "Paul's Letters", 
          description: "Living in light of Christ's return",
          who: "Written by Paul to his first European church",
          what: "Encouragement in persecution, holiness, Christ's second coming",
          when: "Written: c. AD 51 from Corinth",
          where: "To the church in Thessalonica (Macedonia)"
        },
        { 
          name: "2 Thessalonians", 
          chapters: 3, 
          category: "Paul's Letters", 
          description: "Perseverance and the Day of the Lord",
          who: "Written by Paul, clarifying his first letter",
          what: "Perseverance in persecution, events before Christ's return",
          when: "Written: c. AD 51-52 from Corinth",
          where: "To the church in Thessalonica (follow-up letter)"
        },
        { 
          name: "1 Timothy", 
          chapters: 6, 
          category: "Paul's Letters", 
          description: "Instructions for church leadership",
          who: "Written by Paul to Timothy, his younger prot√©g√© in ministry",
          what: "Qualifications for leaders, false teaching, church order",
          when: "Written: c. AD 62-64 from Macedonia",
          where: "To Timothy in Ephesus"
        },
        { 
          name: "2 Timothy", 
          chapters: 4, 
          category: "Paul's Letters", 
          description: "Paul's final words - faithful endurance",
          who: "Written by Paul from prison, his last letter before martyrdom",
          what: "Endure suffering, guard the gospel, pass on the faith",
          when: "Written: c. AD 67 from Rome",
          where: "To Timothy, Paul's final charge to his spiritual son"
        },
        { 
          name: "Titus", 
          chapters: 3, 
          category: "Paul's Letters", 
          description: "Sound doctrine and good works",
          who: "Written by Paul to Titus, his co-worker in ministry",
          what: "Church leadership, sound doctrine, good works flow from grace",
          when: "Written: c. AD 62-64 from Macedonia",
          where: "To Titus on the island of Crete"
        },
        { 
          name: "Philemon", 
          chapters: 1, 
          category: "Paul's Letters", 
          description: "Forgiveness and reconciliation",
          who: "Written by Paul to Philemon about runaway slave Onesimus",
          what: "Appeal for forgiveness and restoration - equality in Christ",
          when: "Written: c. AD 60-62 from Rome",
          where: "Personal letter to Philemon in Colossae"
        },
        { 
          name: "Hebrews", 
          chapters: 13, 
          category: "General Letters", 
          description: "Christ's superiority to all things",
          who: "Author uncertain (possibly Paul, Apollos, or Barnabas)",
          what: "Christ is superior to angels, Moses, priesthood, and old covenant",
          when: "Written: c. AD 65-69, before temple's destruction",
          where: "To Jewish Christians, possibly in Rome or Jerusalem"
        },
        { 
          name: "James", 
          chapters: 5, 
          category: "General Letters", 
          description: "Faith that works - practical Christianity",
          who: "Written by James, half-brother of Jesus and Jerusalem church leader",
          what: "Genuine faith produces good works, practical Christian living",
          when: "Written: c. AD 45-50 (possibly earliest NT book)",
          where: "To Jewish Christians scattered throughout the Roman world"
        },
        { 
          name: "1 Peter", 
          chapters: 5, 
          category: "General Letters", 
          description: "Hope and endurance in suffering",
          who: "Written by Peter the apostle to suffering believers",
          what: "Hope in suffering, holy living as exiles, Christ's example",
          when: "Written: c. AD 62-64 from Rome ('Babylon')",
          where: "To Christians in Asia Minor (modern Turkey)"
        },
        { 
          name: "2 Peter", 
          chapters: 3, 
          category: "General Letters", 
          description: "Growing in grace and knowledge",
          who: "Written by Peter, his final letter before martyrdom",
          what: "Grow in Christ, beware false teachers, Christ will return",
          when: "Written: c. AD 65-68 from Rome",
          where: "To the same audience as 1 Peter"
        },
        { 
          name: "1 John", 
          chapters: 5, 
          category: "General Letters", 
          description: "Assurance of salvation and God's love",
          who: "Written by John the apostle in his old age",
          what: "Tests of genuine faith, God is love, assurance of eternal life",
          when: "Written: c. AD 85-95 from Ephesus",
          where: "To churches in Asia Minor region"
        },
        { 
          name: "2 John", 
          chapters: 1, 
          category: "General Letters", 
          description: "Walking in truth and love",
          who: "Written by John ('the elder') to 'the chosen lady'",
          what: "Walk in truth and love, beware of deceivers",
          when: "Written: c. AD 85-95 from Ephesus",
          where: "To a specific church or Christian woman and her children"
        },
        { 
          name: "3 John", 
          chapters: 1, 
          category: "General Letters", 
          description: "Hospitality and supporting truth",
          who: "Written by John to his friend Gaius",
          what: "Commendation for hospitality, warning about Diotrephes",
          when: "Written: c. AD 85-95 from Ephesus",
          where: "Personal letter to Gaius"
        },
        { 
          name: "Jude", 
          chapters: 1, 
          category: "General Letters", 
          description: "Contending for the faith",
          who: "Written by Jude, half-brother of Jesus",
          what: "Contend for the faith, judgment on false teachers",
          when: "Written: c. AD 65-80",
          where: "To churches threatened by false teaching"
        },
        { 
          name: "Revelation", 
          chapters: 22, 
          category: "Prophecy", 
          description: "The revelation of Jesus Christ and final victory",
          who: "Written by John the apostle in exile on Patmos",
          what: "Apocalyptic visions of Christ's return, judgment, new heaven and earth",
          when: "Written: c. AD 95 during Domitian's persecution",
          where: "To seven churches in Asia Minor, for all believers"
        }
      ]
    };

    // Initialize Element SDK
    async function onConfigChange(config) {
      notebookCurrentConfig = config;
      const backgroundColor = config.background_color || notebookDefaultConfig.background_color;
      const surfaceColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const secondaryColor = config.secondary_color || notebookDefaultConfig.secondary_color;
      const fontFamily = config.font_family || notebookDefaultConfig.font_family;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      document.body.style.backgroundColor = backgroundColor;
      document.body.style.color = textColor;
      document.body.style.fontFamily = `${fontFamily}, Georgia, serif`;
      document.body.style.fontSize = `${fontSize}px`;
      
      const header = document.querySelector('header');
      header.style.backgroundColor = surfaceColor;
      header.style.color = textColor;
      header.style.borderBottom = `1px solid ${secondaryColor}`;
      
      document.getElementById('notebook-title').textContent = config.notebook_title || notebookDefaultConfig.notebook_title;
      document.getElementById('notebook-title').style.fontSize = `${fontSize * 2}px`;
      document.getElementById('notebook-title').style.color = textColor;
      
      document.getElementById('welcome-message').textContent = config.welcome_message || notebookDefaultConfig.welcome_message;
      document.getElementById('welcome-message').style.fontSize = `${fontSize * 0.9}px`;
      document.getElementById('welcome-message').style.color = textColor;
      document.getElementById('welcome-message').style.opacity = '0.7';
      
      const actionButtons = [
        document.getElementById('btn-study-note'),
        document.getElementById('btn-reflection'),
        document.getElementById('btn-prayer'),
        document.getElementById('btn-sermon-notes'),
        document.getElementById('btn-soap'),
        document.getElementById('btn-verse-mapping'),
        document.getElementById('btn-chapter'),
        document.getElementById('btn-word-study'),
        document.getElementById('btn-character')
      ];
      
      actionButtons.forEach(btn => {
        btn.style.backgroundColor = primaryColor;
        btn.style.color = surfaceColor;
        btn.style.fontSize = `${fontSize * 0.9}px`;
        btn.onmouseenter = () => {
          btn.style.backgroundColor = adjustBrightness(primaryColor, -15);
        };
        btn.onmouseleave = () => {
          btn.style.backgroundColor = primaryColor;
        };
      });

      // Style backup buttons
      const backupButtons = document.querySelectorAll('.backup-btn');
      backupButtons.forEach(btn => {
        btn.style.backgroundColor = secondaryColor;
        btn.style.color = surfaceColor;
        btn.style.fontSize = `${fontSize * 0.85}px`;
        btn.onmouseenter = () => {
          btn.style.backgroundColor = adjustBrightness(secondaryColor, -15);
        };
        btn.onmouseleave = () => {
          btn.style.backgroundColor = secondaryColor;
        };
      });

      // Style add reading button
      const addReadingBtn = document.getElementById('btn-add-reading');
      if (addReadingBtn) {
        addReadingBtn.style.backgroundColor = primaryColor;
        addReadingBtn.style.color = surfaceColor;
        addReadingBtn.style.fontSize = `${fontSize}px`;
        addReadingBtn.onmouseenter = () => {
          addReadingBtn.style.backgroundColor = adjustBrightness(primaryColor, -15);
        };
        addReadingBtn.onmouseleave = () => {
          addReadingBtn.style.backgroundColor = primaryColor;
        };
      }
      
      const searchInput = document.getElementById('search-input');
      searchInput.style.backgroundColor = surfaceColor;
      searchInput.style.color = textColor;
      searchInput.style.borderColor = secondaryColor;
      searchInput.style.fontSize = `${fontSize}px`;
      
      const filterTabs = document.querySelectorAll('.filter-tab');
      filterTabs.forEach(tab => {
        const isActive = tab.dataset.filter === currentFilter;
        tab.style.backgroundColor = isActive ? primaryColor : surfaceColor;
        tab.style.color = isActive ? surfaceColor : textColor;
        tab.style.border = `2px solid ${secondaryColor}`;
        tab.style.fontSize = `${fontSize * 0.85}px`;
      });

      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => {
        const isActive = tab.dataset.view === currentView;
        tab.style.backgroundColor = isActive ? primaryColor : surfaceColor;
        tab.style.color = isActive ? surfaceColor : textColor;
        tab.style.fontSize = `${fontSize * 0.9}px`;
      });
      
      const form = document.getElementById('entry-form');
      form.style.backgroundColor = surfaceColor;
      form.style.color = textColor;
      
      const formTitle = document.getElementById('form-title');
      formTitle.style.fontSize = `${fontSize * 1.5}px`;
      formTitle.style.color = textColor;
      
      const labels = form.querySelectorAll('label');
      labels.forEach(label => {
        label.style.fontSize = `${fontSize * 0.9}px`;
        label.style.color = textColor;
      });
      
      const inputs = form.querySelectorAll('input, textarea');
      inputs.forEach(input => {
        input.style.backgroundColor = backgroundColor;
        input.style.color = textColor;
        input.style.borderColor = secondaryColor;
        input.style.fontSize = `${fontSize}px`;
      });
      
      const cancelBtn = document.getElementById('btn-cancel');
      cancelBtn.style.backgroundColor = secondaryColor;
      cancelBtn.style.color = surfaceColor;
      cancelBtn.style.fontSize = `${fontSize * 0.9}px`;
      
      const saveBtn = document.getElementById('btn-save');
      saveBtn.style.backgroundColor = primaryColor;
      saveBtn.style.color = surfaceColor;
      saveBtn.style.fontSize = `${fontSize * 0.9}px`;
      
      const emptyState = document.getElementById('empty-state');
      emptyState.style.color = textColor;
      const emptyIcon = emptyState.querySelector('div');
      emptyIcon.style.fontSize = `${fontSize * 3}px`;
      const emptyTitle = emptyState.querySelector('p:first-of-type');
      emptyTitle.style.fontSize = `${fontSize * 1.125}px`;
      const emptyDesc = emptyState.querySelector('p:last-of-type');
      emptyDesc.style.fontSize = `${fontSize * 0.9}px`;
      
      if (currentView === 'entries') {
        renderEntries();
      } else if (currentView === 'reading') {
        renderReadingView();
      }
    }

    function adjustBrightness(color, percent) {
      const num = parseInt(color.replace("#",""), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
        (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
        .toString(16).slice(1);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        notebookDefaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || notebookDefaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || notebookDefaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || notebookDefaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_color || notebookDefaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || notebookDefaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || notebookDefaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || notebookDefaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["notebook_title", config.notebook_title || notebookDefaultConfig.notebook_title],
          ["welcome_message", config.welcome_message || notebookDefaultConfig.welcome_message]
        ])
      });
    }

    // Initialize Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allEntries = data.sort((a, b) => new Date(b.date_created) - new Date(a.date_created));
        
        if (currentView === 'entries') {
          renderEntries();
        } else if (currentView === 'reading') {
          renderReadingView();
        } else if (currentView === 'books') {
          if (currentBook) {
            renderBookEntries();
          } else {
            renderBooks();
          }
        }
      }
    };

    if (window.dataSdk) {
      window.dataSdk.init(dataHandler);
    }

    // Backup Functions
    document.getElementById('btn-copy-notes').addEventListener('click', copyAllNotes);
    document.getElementById('btn-download-pdf').addEventListener('click', downloadAsPDF);
    document.getElementById('btn-print').addEventListener('click', printNotes);

    function copyAllNotes() {
      const studyEntries = allEntries.filter(e => e.type !== 'reading');
      
      if (studyEntries.length === 0) {
        showToast('No notes to copy');
        return;
      }

      const typeLabels = {
        study: 'Study Note',
        reflection: 'Reflection',
        prayer: 'Prayer',
        sermon: 'Sermon Notes',
        soap: 'SOAP Study',
        verse: 'Verse Mapping',
        chapter: 'Chapter/Book',
        word: 'Word Study',
        character: 'Character Study'
      };

      let text = `${notebookCurrentConfig.notebook_title || notebookDefaultConfig.notebook_title}\n`;
      text += `${'='.repeat(50)}\n\n`;

      studyEntries.forEach((entry, index) => {
        const date = new Date(entry.date_created).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });

        text += `${index + 1}. ${typeLabels[entry.type]}\n`;
        text += `Date: ${date}\n`;

        if (entry.type === 'soap') {
          text += `Title: ${entry.title || 'Untitled'}\n`;
          if (entry.soap_scripture) text += `Scripture: ${entry.soap_scripture}\n`;
          if (entry.soap_observation) text += `\nObservation:\n${entry.soap_observation}\n`;
          if (entry.soap_application) text += `\nApplication:\n${entry.soap_application}\n`;
          if (entry.soap_prayer) text += `\nPrayer:\n${entry.soap_prayer}\n`;
        } else if (entry.type === 'verse') {
          text += `Verse: ${entry.verse_reference || entry.title}\n`;
          if (entry.verse_text) text += `Text: "${entry.verse_text}"\n`;
          if (entry.verse_mapping) text += `\nMapping:\n${entry.verse_mapping}\n`;
          if (entry.tags) text += `Tags: ${entry.tags}\n`;
        } else if (entry.type === 'chapter') {
          text += `Book/Chapter: ${entry.book_chapter || entry.title}\n`;
          if (entry.chapter_summary) text += `\nSummary:\n${entry.chapter_summary}\n`;
          if (entry.key_verses) text += `\nKey Verses:\n${entry.key_verses}\n`;
          if (entry.tags) text += `Tags: ${entry.tags}\n`;
        } else if (entry.type === 'word') {
          text += `Word: ${entry.word || entry.title}\n`;
          if (entry.hebrew_greek) text += `Hebrew/Greek: ${entry.hebrew_greek}\n`;
          if (entry.definition) text += `\nDefinition:\n${entry.definition}\n`;
          if (entry.cross_references) text += `\nCross References:\n${entry.cross_references}\n`;
          if (entry.tags) text += `Tags: ${entry.tags}\n`;
        } else if (entry.type === 'character') {
          text += `Character: ${entry.character_name || entry.title}\n`;
          if (entry.scripture_reference) text += `Scripture: ${entry.scripture_reference}\n`;
          if (entry.character_background) text += `\nBackground:\n${entry.character_background}\n`;
          if (entry.character_traits) text += `\nCharacter Traits:\n${entry.character_traits}\n`;
          if (entry.key_events) text += `\nKey Events:\n${entry.key_events}\n`;
          if (entry.relationships) text += `\nRelationships:\n${entry.relationships}\n`;
          if (entry.spiritual_lessons) text += `\nSpiritual Lessons:\n${entry.spiritual_lessons}\n`;
          if (entry.tags) text += `Tags: ${entry.tags}\n`;
        } else {
          text += `Title: ${entry.title || 'Untitled'}\n`;
          if (entry.scripture_reference) text += `Scripture: ${entry.scripture_reference}\n`;
          if (entry.content) text += `\n${entry.content}\n`;
          if (entry.tags) text += `Tags: ${entry.tags}\n`;
        }

        text += `\n${'-'.repeat(50)}\n\n`;
      });

      navigator.clipboard.writeText(text).then(() => {
        showToast('All notes copied to clipboard!');
      }).catch(() => {
        showToast('Failed to copy notes');
      });
    }

    function downloadAsPDF() {
      const studyEntries = allEntries.filter(e => e.type !== 'reading');
      
      if (studyEntries.length === 0) {
        showToast('No notes to download');
        return;
      }

      const typeLabels = {
        study: 'Study Note',
        reflection: 'Reflection',
        prayer: 'Prayer',
        sermon: 'Sermon Notes',
        soap: 'SOAP Study',
        verse: 'Verse Mapping',
        chapter: 'Chapter/Book',
        word: 'Word Study',
        character: 'Character Study'
      };

      let content = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>${notebookCurrentConfig.notebook_title || notebookDefaultConfig.notebook_title}</title>
  <style>
    body { font-family: Georgia, serif; max-width: 800px; margin: 40px auto; padding: 20px; line-height: 1.6; }
    h1 { color: #8b6f47; border-bottom: 3px solid #8b6f47; padding-bottom: 10px; }
    .entry { margin-bottom: 40px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; break-inside: avoid; }
    .entry-type { color: #8b6f47; font-weight: bold; font-size: 0.9em; }
    .entry-title { font-size: 1.3em; font-weight: bold; margin: 10px 0; }
    .entry-date { color: #666; font-size: 0.85em; }
    .section-label { font-weight: bold; margin-top: 15px; color: #8b6f47; }
    .verse-text { font-style: italic; background: #f5f5f5; padding: 10px; border-radius: 4px; margin: 10px 0; }
    .tags { margin-top: 10px; }
    .tag { background: #8b6f47; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.8em; margin-right: 5px; display: inline-block; }
  </style>
</head>
<body>
  <h1>${notebookCurrentConfig.notebook_title || notebookDefaultConfig.notebook_title}</h1>
`;

      studyEntries.forEach((entry) => {
        const date = new Date(entry.date_created).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });

        content += `<div class="entry">`;
        content += `<div class="entry-type">${typeLabels[entry.type]}</div>`;
        content += `<div class="entry-date">${date}</div>`;

        if (entry.type === 'soap') {
          content += `<div class="entry-title">${entry.title || 'Untitled'}</div>`;
          if (entry.soap_scripture) content += `<p><strong>üìñ Scripture:</strong> ${entry.soap_scripture}</p>`;
          if (entry.soap_observation) content += `<div class="section-label">üëÅÔ∏è Observation:</div><p>${entry.soap_observation.replace(/\n/g, '<br>')}</p>`;
          if (entry.soap_application) content += `<div class="section-label">üí° Application:</div><p>${entry.soap_application.replace(/\n/g, '<br>')}</p>`;
          if (entry.soap_prayer) content += `<div class="section-label">üôè Prayer:</div><p>${entry.soap_prayer.replace(/\n/g, '<br>')}</p>`;
        } else if (entry.type === 'verse') {
          content += `<div class="entry-title">${entry.verse_reference || entry.title}</div>`;
          if (entry.verse_text) content += `<div class="verse-text">"${entry.verse_text}"</div>`;
          if (entry.verse_mapping) content += `<p>${entry.verse_mapping.replace(/\n/g, '<br>')}</p>`;
          if (entry.tags) {
            content += `<div class="tags">`;
            entry.tags.split(',').forEach(tag => {
              content += `<span class="tag">${tag.trim()}</span>`;
            });
            content += `</div>`;
          }
        } else if (entry.type === 'chapter') {
          content += `<div class="entry-title">${entry.book_chapter || entry.title}</div>`;
          if (entry.chapter_summary) content += `<p>${entry.chapter_summary.replace(/\n/g, '<br>')}</p>`;
          if (entry.key_verses) content += `<div class="section-label">üîë Key Verses:</div><p>${entry.key_verses.replace(/\n/g, '<br>')}</p>`;
          if (entry.tags) {
            content += `<div class="tags">`;
            entry.tags.split(',').forEach(tag => {
              content += `<span class="tag">${tag.trim()}</span>`;
            });
            content += `</div>`;
          }
        } else if (entry.type === 'word') {
          content += `<div class="entry-title">${entry.word || entry.title}</div>`;
          if (entry.hebrew_greek) content += `<p><em>${entry.hebrew_greek}</em></p>`;
          if (entry.definition) content += `<div class="section-label">Definition:</div><p>${entry.definition.replace(/\n/g, '<br>')}</p>`;
          if (entry.cross_references) content += `<div class="section-label">Cross References:</div><p>${entry.cross_references.replace(/\n/g, '<br>')}</p>`;
          if (entry.tags) {
            content += `<div class="tags">`;
            entry.tags.split(',').forEach(tag => {
              content += `<span class="tag">${tag.trim()}</span>`;
            });
            content += `</div>`;
          }
        } else if (entry.type === 'character') {
          content += `<div class="entry-title">${entry.character_name || entry.title}</div>`;
          if (entry.scripture_reference) content += `<p><strong>üìñ Scripture:</strong> ${entry.scripture_reference}</p>`;
          if (entry.character_background) content += `<div class="section-label">üìù Background:</div><p>${entry.character_background.replace(/\n/g, '<br>')}</p>`;
          if (entry.character_traits) content += `<div class="section-label">‚≠ê Character Traits:</div><p>${entry.character_traits.replace(/\n/g, '<br>')}</p>`;
          if (entry.key_events) content += `<div class="section-label">üéØ Key Events:</div><p>${entry.key_events.replace(/\n/g, '<br>')}</p>`;
          if (entry.relationships) content += `<div class="section-label">üë• Relationships:</div><p>${entry.relationships.replace(/\n/g, '<br>')}</p>`;
          if (entry.spiritual_lessons) content += `<div class="section-label">üí° Spiritual Lessons:</div><p>${entry.spiritual_lessons.replace(/\n/g, '<br>')}</p>`;
          if (entry.tags) {
            content += `<div class="tags">`;
            entry.tags.split(',').forEach(tag => {
              content += `<span class="tag">${tag.trim()}</span>`;
            });
            content += `</div>`;
          }
        } else {
          content += `<div class="entry-title">${entry.title || 'Untitled'}</div>`;
          if (entry.scripture_reference) content += `<p><strong>üìñ Scripture:</strong> ${entry.scripture_reference}</p>`;
          if (entry.content) content += `<p>${entry.content.replace(/\n/g, '<br>')}</p>`;
          if (entry.tags) {
            content += `<div class="tags">`;
            entry.tags.split(',').forEach(tag => {
              content += `<span class="tag">${tag.trim()}</span>`;
            });
            content += `</div>`;
          }
        }

        content += `</div>`;
      });

      content += `</body></html>`;

      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Bible_Study_Notes_${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Notes downloaded as HTML file!');
    }

    function printNotes() {
      const studyEntries = allEntries.filter(e => e.type !== 'reading');
      
      if (studyEntries.length === 0) {
        showToast('No notes to print');
        return;
      }

      window.print();
    }

    // Daily Reading Functions
    document.getElementById('btn-add-reading').addEventListener('click', markTodayComplete);

    async function markTodayComplete() {
      if (allEntries.length >= 999) {
        showToast('Maximum limit of 999 entries reached');
        return;
      }

      const today = new Date().toISOString().split('T')[0];
      const alreadyLogged = allEntries.some(e => e.type === 'reading' && e.reading_date === today);

      if (alreadyLogged) {
        showToast('Already logged today\'s reading!');
        return;
      }

      const btn = document.getElementById('btn-add-reading');
      btn.textContent = 'Saving...';
      btn.disabled = true;

      const entry = {
        id: Date.now().toString(),
        type: 'reading',
        reading_date: today,
        date_created: new Date().toISOString(),
        is_completed: true,
        title: 'Daily Reading',
        scripture_reference: '',
        content: '',
        tags: '',
        book_name: ''
      };

      const result = await window.dataSdk.create(entry);

      btn.textContent = '‚úÖ Mark Today\'s Reading Complete';
      btn.disabled = false;

      if (result.isOk) {
        showToast('Today\'s reading marked complete! üéâ');
      } else {
        showToast('Failed to save. Please try again.');
      }
    }

    function renderReadingView() {
      const readingEntries = allEntries.filter(e => e.type === 'reading');
      
      // Calculate stats
      const totalDays = readingEntries.length;
      const today = new Date().toISOString().split('T')[0];
      const readToday = readingEntries.some(e => e.reading_date === today);
      
      // Calculate streak
      let currentStreak = 0;
      const sortedDates = readingEntries
        .map(e => e.reading_date)
        .sort()
        .reverse();
      
      const todayDate = new Date();
      let checkDate = new Date(todayDate);
      
      for (let date of sortedDates) {
        const entryDate = new Date(date + 'T00:00:00');
        const checkDateStr = checkDate.toISOString().split('T')[0];
        
        if (date === checkDateStr) {
          currentStreak++;
          checkDate.setDate(checkDate.getDate() - 1);
        } else {
          break;
        }
      }

      // Render stats
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const backgroundColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;

      const statsContainer = document.getElementById('reading-stats');
      statsContainer.innerHTML = `
        <div class="rounded-lg shadow-md p-6 text-center" style="background-color: ${backgroundColor}; color: ${textColor};">
          <div class="mb-2" style="font-size: ${fontSize * 2.5}px;">${currentStreak > 0 ? 'üî•' : 'üìñ'}</div>
          <div class="font-bold mb-1" style="font-size: ${fontSize * 2}px; color: ${primaryColor};">${currentStreak}</div>
          <div class="opacity-70" style="font-size: ${fontSize * 0.9}px;">Day Streak</div>
        </div>
        <div class="rounded-lg shadow-md p-6 text-center" style="background-color: ${backgroundColor}; color: ${textColor};">
          <div class="mb-2" style="font-size: ${fontSize * 2.5}px;">üìÖ</div>
          <div class="font-bold mb-1" style="font-size: ${fontSize * 2}px; color: ${primaryColor};">${totalDays}</div>
          <div class="opacity-70" style="font-size: ${fontSize * 0.9}px;">Total Days</div>
        </div>
        <div class="rounded-lg shadow-md p-6 text-center" style="background-color: ${backgroundColor}; color: ${textColor};">
          <div class="mb-2" style="font-size: ${fontSize * 2.5}px;">${readToday ? '‚úÖ' : '‚è≥'}</div>
          <div class="font-bold mb-1" style="font-size: ${fontSize * 1.5}px; color: ${primaryColor};">${readToday ? 'Complete' : 'Pending'}</div>
          <div class="opacity-70" style="font-size: ${fontSize * 0.9}px;">Today's Reading</div>
        </div>
      `;

      // Render reading history
      const readingList = document.getElementById('reading-list');
      const readingEmpty = document.getElementById('reading-empty');

      if (readingEntries.length === 0) {
        readingList.innerHTML = '';
        readingEmpty.classList.remove('hidden');
        readingEmpty.style.color = textColor;
        readingEmpty.style.fontSize = `${fontSize}px`;
        return;
      }

      readingEmpty.classList.add('hidden');
      
      readingList.innerHTML = readingEntries.map(entry => {
        const date = new Date(entry.reading_date + 'T00:00:00');
        const formattedDate = date.toLocaleDateString('en-US', { 
          weekday: 'long',
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });

        return `
          <div class="rounded-lg shadow-md p-4 flex justify-between items-center" style="background-color: ${backgroundColor}; color: ${textColor};">
            <div class="flex items-center gap-3">
              <span style="font-size: ${fontSize * 1.5}px;">‚úÖ</span>
              <div>
                <div class="font-semibold" style="font-size: ${fontSize}px;">${formattedDate}</div>
                <div class="opacity-70" style="font-size: ${fontSize * 0.85}px;">Daily reading completed</div>
              </div>
            </div>
            <button class="delete-reading-btn px-3 py-1 rounded font-medium transition-colors" 
                    data-entry-id="${entry.__backendId}"
                    style="background-color: ${config.secondary_color || notebookDefaultConfig.secondary_color}; color: ${backgroundColor}; font-size: ${fontSize * 0.85}px;">
              Delete
            </button>
          </div>
        `;
      }).join('');

      // Add delete handlers
      document.querySelectorAll('.delete-reading-btn').forEach(btn => {
        btn.onclick = async () => {
          const entryId = btn.dataset.entryId;
          const entry = allEntries.find(e => e.__backendId === entryId);
          if (entry) {
            await window.dataSdk.delete(entry);
          }
        };
      });
    }

    // Event Listeners
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const view = tab.dataset.view;
        switchView(view);
      });
    });

    document.querySelectorAll('.testament-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        currentTestament = tab.dataset.testament;
        updateTestamentTabs();
        renderBooks();
      });
    });

    document.getElementById('back-to-books').addEventListener('click', () => {
      currentBook = null;
      document.getElementById('books-grid').classList.remove('hidden');
      document.getElementById('book-detail').classList.add('hidden');
    });

    document.getElementById('btn-study-note').addEventListener('click', () => showForm('study', 'Study Note'));
    document.getElementById('btn-reflection').addEventListener('click', () => showForm('reflection', 'Reflection'));
    document.getElementById('btn-prayer').addEventListener('click', () => showForm('prayer', 'Prayer'));
    document.getElementById('btn-sermon-notes').addEventListener('click', () => showForm('sermon', 'Sermon Notes'));
    document.getElementById('btn-soap').addEventListener('click', () => showForm('soap', 'SOAP Study'));
    document.getElementById('btn-verse-mapping').addEventListener('click', () => showForm('verse', 'Verse Mapping'));
    document.getElementById('btn-chapter').addEventListener('click', () => showForm('chapter', 'Chapter/Book Study'));
    document.getElementById('btn-word-study').addEventListener('click', () => showForm('word', 'Word Study'));
    document.getElementById('btn-character').addEventListener('click', () => showForm('character', 'Character Study'));

    document.querySelectorAll('.book-tool-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tool = btn.dataset.tool;
        const toolNames = {
          study: 'Study Note',
          reflection: 'Reflection',
          prayer: 'Prayer',
          soap: 'SOAP Study',
          verse: 'Verse Mapping',
          chapter: 'Chapter Study',
          word: 'Word Study',
          character: 'Character Study'
        };
        showForm(tool, toolNames[tool], currentBook.name);
      });
    });

    document.getElementById('btn-cancel').addEventListener('click', hideForm);

    document.getElementById('search-input').addEventListener('input', (e) => {
      searchQuery = e.target.value.toLowerCase();
      renderEntries();
    });

    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        currentFilter = tab.dataset.filter;
        document.querySelectorAll('.filter-tab').forEach(t => {
          const isActive = t.dataset.filter === currentFilter;
          t.style.backgroundColor = isActive ? notebookCurrentConfig.primary_color || notebookDefaultConfig.primary_color : notebookCurrentConfig.surface_color || notebookDefaultConfig.surface_color;
          t.style.color = isActive ? notebookCurrentConfig.surface_color || notebookDefaultConfig.surface_color : notebookCurrentConfig.text_color || notebookDefaultConfig.text_color;
        });
        renderEntries();
      });
    });

    document.getElementById('note-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allEntries.length >= 999) {
        showToast('Maximum limit of 999 entries reached. Please delete some entries first.');
        return;
      }
      
      const saveBtn = document.getElementById('btn-save');
      const originalText = saveBtn.textContent;
      saveBtn.textContent = 'Saving...';
      saveBtn.disabled = true;
      
      let entry = {
        id: Date.now().toString(),
        type: currentEntryType,
        date_created: new Date().toISOString(),
        book_name: currentBook ? currentBook.name : '',
        is_favorite: false
      };
      
      // Build entry based on type
      if (currentEntryType === 'soap') {
        entry.title = document.getElementById('soap-title').value;
        entry.soap_scripture = document.getElementById('soap-scripture').value;
        entry.soap_observation = document.getElementById('soap-observation').value;
        entry.soap_application = document.getElementById('soap-application').value;
        entry.soap_prayer = document.getElementById('soap-prayer').value;
        entry.tags = '';
      } else if (currentEntryType === 'verse') {
        entry.title = document.getElementById('verse-reference').value;
        entry.verse_reference = document.getElementById('verse-reference').value;
        entry.verse_text = document.getElementById('verse-text').value;
        entry.verse_mapping = document.getElementById('verse-mapping').value;
        entry.tags = document.getElementById('verse-tags').value;
      } else if (currentEntryType === 'chapter') {
        entry.title = document.getElementById('book-chapter').value;
        entry.book_chapter = document.getElementById('book-chapter').value;
        entry.chapter_summary = document.getElementById('chapter-summary').value;
        entry.key_verses = document.getElementById('key-verses').value;
        entry.tags = document.getElementById('chapter-tags').value;
        if (!entry.book_name && entry.book_chapter) {
          const bookMatch = entry.book_chapter.match(/^([\w\s]+?)(\s+\d+)?$/);
          if (bookMatch) entry.book_name = bookMatch[1].trim();
        }
      } else if (currentEntryType === 'word') {
        entry.title = document.getElementById('word').value;
        entry.word = document.getElementById('word').value;
        entry.hebrew_greek = document.getElementById('hebrew-greek').value;
        entry.definition = document.getElementById('definition').value;
        entry.cross_references = document.getElementById('cross-references').value;
        entry.tags = document.getElementById('word-tags').value;
      } else if (currentEntryType === 'character') {
        entry.title = document.getElementById('character-name').value;
        entry.character_name = document.getElementById('character-name').value;
        entry.scripture_reference = document.getElementById('character-scripture').value;
        entry.character_background = document.getElementById('character-background').value;
        entry.character_traits = document.getElementById('character-traits').value;
        entry.key_events = document.getElementById('key-events').value;
        entry.relationships = document.getElementById('relationships').value;
        entry.spiritual_lessons = document.getElementById('spiritual-lessons').value;
        entry.tags = document.getElementById('character-tags').value;
      } else {
        entry.title = document.getElementById('entry-title').value;
        entry.scripture_reference = document.getElementById('scripture-ref').value;
        entry.content = document.getElementById('entry-content').value;
        entry.tags = document.getElementById('entry-tags').value;
      }
      
      const result = await window.dataSdk.create(entry);
      
      saveBtn.textContent = originalText;
      saveBtn.disabled = false;
      
      if (result.isOk) {
        document.getElementById('note-form').reset();
        hideForm();
        showToast('Entry saved successfully!');
      } else {
        showToast('Failed to save entry. Please try again.');
      }
    });

    function switchView(view) {
      currentView = view;
      
      // Update nav tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        const isActive = tab.dataset.view === view;
        tab.style.backgroundColor = isActive ? notebookCurrentConfig.primary_color || notebookDefaultConfig.primary_color : notebookCurrentConfig.surface_color || notebookDefaultConfig.surface_color;
        tab.style.color = isActive ? notebookCurrentConfig.surface_color || notebookDefaultConfig.surface_color : notebookCurrentConfig.text_color || notebookDefaultConfig.text_color;
      });
      
      // Show/hide views
      if (view === 'entries') {
        document.getElementById('entries-view').classList.remove('hidden');
        document.getElementById('reading-view').classList.add('hidden');
        document.getElementById('books-view').classList.add('hidden');
        document.querySelectorAll('.filter-tab').forEach(t => t.parentElement.classList.remove('hidden'));
        document.getElementById('search-input').parentElement.parentElement.classList.remove('hidden');
        renderEntries();
      } else if (view === 'reading') {
        document.getElementById('entries-view').classList.add('hidden');
        document.getElementById('reading-view').classList.remove('hidden');
        document.getElementById('books-view').classList.add('hidden');
        document.querySelectorAll('.filter-tab').forEach(t => t.parentElement.classList.add('hidden'));
        document.getElementById('search-input').parentElement.parentElement.classList.add('hidden');
        renderReadingView();
      } else if (view === 'books') {
        document.getElementById('entries-view').classList.add('hidden');
        document.getElementById('reading-view').classList.add('hidden');
        document.getElementById('books-view').classList.remove('hidden');
        document.getElementById('books-grid').classList.remove('hidden');
        document.getElementById('book-detail').classList.add('hidden');
        document.querySelectorAll('.filter-tab').forEach(t => t.parentElement.classList.add('hidden'));
        document.getElementById('search-input').parentElement.parentElement.classList.add('hidden');
        updateTestamentTabs();
        renderBooks();
      }
    }

    function updateTestamentTabs() {
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const surfaceColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      document.querySelectorAll('.testament-tab').forEach(tab => {
        const isActive = tab.dataset.testament === currentTestament;
        tab.style.backgroundColor = isActive ? primaryColor : surfaceColor;
        tab.style.color = isActive ? surfaceColor : textColor;
        tab.style.fontSize = `${fontSize * 0.9}px`;
        tab.onmouseenter = () => {
          if (!isActive) tab.style.backgroundColor = adjustBrightness(surfaceColor, -5);
        };
        tab.onmouseleave = () => {
          if (!isActive) tab.style.backgroundColor = surfaceColor;
        };
      });
    }

    function renderBooks() {
      const grid = document.getElementById('books-grid');
      const books = bibleBooks[currentTestament];
      
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const backgroundColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const secondaryColor = config.secondary_color || notebookDefaultConfig.secondary_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      grid.innerHTML = books.map(book => {
        const bookEntries = allEntries.filter(e => e.book_name === book.name && e.type !== 'reading');
        const entryCount = bookEntries.length;
        
        return `
          <div class="book-card rounded-lg shadow-md p-5 cursor-pointer transition-all" 
               style="background-color: ${backgroundColor}; color: ${textColor}; border: 1px solid ${secondaryColor};"
               data-book="${book.name}">
            <div class="flex justify-between items-start mb-2">
              <h3 class="font-bold" style="font-size: ${fontSize * 1.125}px; color: ${primaryColor};">${book.name}</h3>
              <span class="px-2 py-1 rounded text-xs" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.7}px;">${book.category}</span>
            </div>
            <p class="opacity-70 mb-2" style="font-size: ${fontSize * 0.85}px;">${book.chapters} chapters</p>
            <p class="mb-3" style="font-size: ${fontSize * 0.9}px;">${book.description}</p>
            ${entryCount > 0 ? `<p class="font-medium" style="font-size: ${fontSize * 0.85}px; color: ${primaryColor};">üìù ${entryCount} ${entryCount === 1 ? 'study' : 'studies'}</p>` : ''}
          </div>
        `;
      }).join('');
      
      grid.querySelectorAll('.book-card').forEach(card => {
        const bookName = card.dataset.book;
        card.onclick = () => showBookDetail(bookName);
        card.onmouseenter = () => {
          card.style.transform = 'translateY(-2px)';
          card.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        };
        card.onmouseleave = () => {
          card.style.transform = 'translateY(0)';
          card.style.boxShadow = '';
        };
      });
    }

    function showBookDetail(bookName) {
      const testament = currentTestament;
      const book = bibleBooks[testament].find(b => b.name === bookName);
      if (!book) return;
      
      currentBook = book;
      
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const backgroundColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const secondaryColor = config.secondary_color || notebookDefaultConfig.secondary_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      const backBtn = document.getElementById('back-to-books');
      backBtn.style.backgroundColor = secondaryColor;
      backBtn.style.color = backgroundColor;
      backBtn.style.fontSize = `${fontSize * 0.9}px`;
      
      const detailContent = document.getElementById('book-detail-content');
      detailContent.style.backgroundColor = backgroundColor;
      detailContent.style.color = textColor;
      detailContent.style.borderColor = secondaryColor;
      
      detailContent.innerHTML = `
        <div class="mb-3">
          <span class="px-3 py-1 rounded" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.8}px;">${book.category}</span>
        </div>
        <h2 class="font-bold mb-4" style="font-size: ${fontSize * 2}px; color: ${primaryColor};">${book.name}</h2>
        <p class="mb-4 italic" style="font-size: ${fontSize}px; color: ${textColor};">${book.description}</p>
        <p class="mb-2" style="font-size: ${fontSize * 0.9}px; color: ${textColor};"><strong>Chapters:</strong> ${book.chapters}</p>
        
        <div class="mt-4 space-y-3">
          <div class="p-3 rounded" style="background-color: ${adjustBrightness(backgroundColor, -3)};">
            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor};"><strong>üë§ WHO:</strong> ${book.who}</p>
          </div>
          <div class="p-3 rounded" style="background-color: ${adjustBrightness(backgroundColor, -3)};">
            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor};"><strong>üìñ WHAT:</strong> ${book.what}</p>
          </div>
          <div class="p-3 rounded" style="background-color: ${adjustBrightness(backgroundColor, -3)};">
            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor};"><strong>üìÖ WHEN:</strong> ${book.when}</p>
          </div>
          <div class="p-3 rounded" style="background-color: ${adjustBrightness(backgroundColor, -3)};">
            <p style="font-size: ${fontSize * 0.9}px; color: ${textColor};"><strong>üåç WHERE:</strong> ${book.where}</p>
          </div>
        </div>
      `;
      
      const toolsTitle = document.getElementById('book-tools-title');
      toolsTitle.style.fontSize = `${fontSize * 1.25}px`;
      toolsTitle.style.color = textColor;
      
      document.querySelectorAll('.book-tool-btn').forEach(btn => {
        btn.style.backgroundColor = primaryColor;
        btn.style.color = backgroundColor;
        btn.style.fontSize = `${fontSize * 0.85}px`;
        btn.onmouseenter = () => btn.style.backgroundColor = adjustBrightness(primaryColor, -15);
        btn.onmouseleave = () => btn.style.backgroundColor = primaryColor;
      });
      
      const entriesTitle = document.getElementById('book-entries-title');
      entriesTitle.style.fontSize = `${fontSize * 1.25}px`;
      entriesTitle.style.color = textColor;
      
      document.getElementById('books-grid').classList.add('hidden');
      document.getElementById('book-detail').classList.remove('hidden');
      
      renderBookEntries();
    }

    function renderBookEntries() {
      if (!currentBook) return;
      
      const container = document.getElementById('book-entries-container');
      const emptyState = document.getElementById('book-entries-empty');
      
      const bookEntries = allEntries.filter(e => e.book_name === currentBook.name && e.type !== 'reading');
      
      if (bookEntries.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      
      container.innerHTML = '';
      bookEntries.forEach(entry => {
        container.appendChild(createEntryElement(entry));
      });
    }

    function showForm(type, title, bookName = null) {
      currentEntryType = type;
      document.getElementById('form-title').textContent = `New ${title}${bookName ? ` - ${bookName}` : ''}`;
      
      document.getElementById('basic-form').classList.add('hidden');
      document.getElementById('soap-form').classList.add('hidden');
      document.getElementById('verse-form').classList.add('hidden');
      document.getElementById('chapter-form').classList.add('hidden');
      document.getElementById('word-form').classList.add('hidden');
      document.getElementById('character-form').classList.add('hidden');
      
      if (type === 'soap') {
        document.getElementById('soap-form').classList.remove('hidden');
      } else if (type === 'verse') {
        document.getElementById('verse-form').classList.remove('hidden');
      } else if (type === 'chapter') {
        document.getElementById('chapter-form').classList.remove('hidden');
        if (bookName) {
          document.getElementById('book-chapter').value = bookName;
        }
      } else if (type === 'word') {
        document.getElementById('word-form').classList.remove('hidden');
      } else if (type === 'character') {
        document.getElementById('character-form').classList.remove('hidden');
      } else {
        document.getElementById('basic-form').classList.remove('hidden');
      }
      
      document.getElementById('entry-form').classList.remove('hidden');
      document.getElementById('entry-form').scrollIntoView({ behavior: 'smooth' });
    }

    function hideForm() {
      document.getElementById('entry-form').classList.add('hidden');
      document.getElementById('note-form').reset();
    }

    function renderEntries() {
      const container = document.getElementById('entries-container');
      const emptyState = document.getElementById('empty-state');
      
      let filteredEntries = allEntries.filter(e => e.type !== 'reading');
      
      if (currentFilter === 'favorites') {
        filteredEntries = filteredEntries.filter(e => e.is_favorite === true);
      } else if (currentFilter !== 'all') {
        filteredEntries = filteredEntries.filter(e => e.type === currentFilter);
      }
      
      if (searchQuery) {
        filteredEntries = filteredEntries.filter(entry => {
          const searchableText = [
            entry.title || '',
            entry.scripture_reference || '',
            entry.content || '',
            entry.tags || '',
            entry.soap_scripture || '',
            entry.soap_observation || '',
            entry.soap_application || '',
            entry.soap_prayer || '',
            entry.verse_reference || '',
            entry.verse_text || '',
            entry.verse_mapping || '',
            entry.book_chapter || '',
            entry.chapter_summary || '',
            entry.key_verses || '',
            entry.word || '',
            entry.hebrew_greek || '',
            entry.definition || '',
            entry.cross_references || '',
            entry.character_name || '',
            entry.character_background || '',
            entry.character_traits || '',
            entry.key_events || '',
            entry.relationships || '',
            entry.spiritual_lessons || ''
          ].join(' ').toLowerCase();
          
          return searchableText.includes(searchQuery);
        });
      }
      
      if (filteredEntries.length === 0) {
        container.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      const existingEntries = new Map(
        [...container.children].map(el => [el.dataset.entryId, el])
      );
      
      filteredEntries.forEach(entry => {
        if (existingEntries.has(entry.id)) {
          updateEntryElement(existingEntries.get(entry.id), entry);
          existingEntries.delete(entry.id);
        } else {
          container.appendChild(createEntryElement(entry));
        }
      });
      
      existingEntries.forEach(el => el.remove());
    }

    function createEntryElement(entry) {
      const div = document.createElement('div');
      div.className = 'entry-card rounded-lg shadow-md p-6';
      div.dataset.entryId = entry.id;
      
      updateEntryElement(div, entry);
      
      return div;
    }

    function updateEntryElement(element, entry) {
      const typeEmojis = {
        study: '‚úèÔ∏è',
        reflection: 'üí≠',
        prayer: 'üôè',
        sermon: 'üìñ',
        soap: 'üßº',
        verse: 'üó∫Ô∏è',
        chapter: 'üìö',
        word: 'üîç',
        character: 'üë§'
      };
      
      const typeLabels = {
        study: 'Study Note',
        reflection: 'Reflection',
        prayer: 'Prayer',
        sermon: 'Sermon Notes',
        soap: 'SOAP Study',
        verse: 'Verse Mapping',
        chapter: 'Chapter/Book',
        word: 'Word Study',
        character: 'Character Study'
      };
      
      const date = new Date(entry.date_created);
      const formattedDate = date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
      
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const backgroundColor = config.surface_color || notebookDefaultConfig.surface_color;
      const textColor = config.text_color || notebookDefaultConfig.text_color;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const secondaryColor = config.secondary_color || notebookDefaultConfig.secondary_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      element.style.backgroundColor = backgroundColor;
      element.style.color = textColor;
      element.style.border = `1px solid ${secondaryColor}`;
      
      const isFavorite = entry.is_favorite === true;
      
      let contentHTML = `
        <div class="flex justify-between items-start mb-3">
          <div class="flex items-center gap-2">
            <span style="font-size: ${fontSize * 1.25}px;">${typeEmojis[entry.type]}</span>
            <span class="font-medium opacity-70" style="font-size: ${fontSize * 0.85}px;">${typeLabels[entry.type]}</span>
          </div>
          <div class="flex gap-2">
            <button class="star-btn no-print" data-entry-id="${entry.__backendId}" style="font-size: ${fontSize * 1.5}px; background: none; border: none; padding: 0;">
              ${isFavorite ? '‚≠ê' : '‚òÜ'}
            </button>
            <button class="delete-btn px-3 py-1 rounded font-medium no-print" style="background-color: ${secondaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.85}px;">Delete</button>
          </div>
        </div>
      `;
      
      // Render based on entry type
      if (entry.type === 'soap') {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">${entry.title || 'Untitled'}</h3>
          ${entry.soap_scripture ? `<p class="font-semibold mb-3" style="color: ${primaryColor}; font-size: ${fontSize}px;">üìñ ${entry.soap_scripture}</p>` : ''}
          ${entry.soap_observation ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üëÅÔ∏è Observation:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.soap_observation}</p></div>` : ''}
          ${entry.soap_application ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üí° Application:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.soap_application}</p></div>` : ''}
          ${entry.soap_prayer ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üôè Prayer:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.soap_prayer}</p></div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      } else if (entry.type === 'verse') {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${primaryColor};">${entry.verse_reference || entry.title || 'Untitled'}</h3>
          ${entry.verse_text ? `<p class="italic mb-3 p-3 rounded" style="font-size: ${fontSize}px; color: ${textColor}; background-color: ${adjustBrightness(backgroundColor, -5)};">"${entry.verse_text}"</p>` : ''}
          ${entry.verse_mapping ? `<p class="mb-3 whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.verse_mapping}</p>` : ''}
          ${entry.tags ? `<div class="flex flex-wrap gap-2 mb-3">
            ${entry.tags.split(',').map(tag => `<span class="px-3 py-1 rounded-full" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.75}px;">${tag.trim()}</span>`).join('')}
          </div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      } else if (entry.type === 'chapter') {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${primaryColor};">${entry.book_chapter || entry.title || 'Untitled'}</h3>
          ${entry.chapter_summary ? `<p class="mb-3 whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.chapter_summary}</p>` : ''}
          ${entry.key_verses ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üîë Key Verses:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.key_verses}</p></div>` : ''}
          ${entry.tags ? `<div class="flex flex-wrap gap-2 mb-3">
            ${entry.tags.split(',').map(tag => `<span class="px-3 py-1 rounded-full" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.75}px;">${tag.trim()}</span>`).join('')}
          </div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      } else if (entry.type === 'word') {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${primaryColor};">${entry.word || entry.title || 'Untitled'}</h3>
          ${entry.hebrew_greek ? `<p class="italic mb-2" style="font-size: ${fontSize}px; color: ${textColor};">${entry.hebrew_greek}</p>` : ''}
          ${entry.definition ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">Definition:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.definition}</p></div>` : ''}
          ${entry.cross_references ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">Cross References:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.cross_references}</p></div>` : ''}
          ${entry.tags ? `<div class="flex flex-wrap gap-2 mb-3">
            ${entry.tags.split(',').map(tag => `<span class="px-3 py-1 rounded-full" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.75}px;">${tag.trim()}</span>`).join('')}
          </div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      } else if (entry.type === 'character') {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${primaryColor};">${entry.character_name || entry.title || 'Untitled'}</h3>
          ${entry.scripture_reference ? `<p class="font-semibold mb-3" style="color: ${primaryColor}; font-size: ${fontSize * 0.9}px;">üìñ ${entry.scripture_reference}</p>` : ''}
          ${entry.character_background ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üìù Background:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.character_background}</p></div>` : ''}
          ${entry.character_traits ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">‚≠ê Character Traits:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.character_traits}</p></div>` : ''}
          ${entry.key_events ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üéØ Key Events:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.key_events}</p></div>` : ''}
          ${entry.relationships ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üë• Relationships:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.relationships}</p></div>` : ''}
          ${entry.spiritual_lessons ? `<div class="mb-3"><p class="font-semibold mb-1" style="font-size: ${fontSize * 0.9}px; color: ${textColor};">üí° Spiritual Lessons:</p><p class="whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.spiritual_lessons}</p></div>` : ''}
          ${entry.tags ? `<div class="flex flex-wrap gap-2 mb-3">
            ${entry.tags.split(',').map(tag => `<span class="px-3 py-1 rounded-full" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.75}px;">${tag.trim()}</span>`).join('')}
          </div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      } else {
        contentHTML += `
          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">${entry.title || 'Untitled'}</h3>
          ${entry.scripture_reference ? `<p class="font-semibold mb-2" style="color: ${primaryColor}; font-size: ${fontSize}px;">üìñ ${entry.scripture_reference}</p>` : ''}
          ${entry.content ? `<p class="mb-3 whitespace-pre-wrap" style="font-size: ${fontSize}px; color: ${textColor};">${entry.content}</p>` : ''}
          ${entry.tags ? `<div class="flex flex-wrap gap-2 mb-3">
            ${entry.tags.split(',').map(tag => `<span class="px-3 py-1 rounded-full" style="background-color: ${primaryColor}; color: ${backgroundColor}; font-size: ${fontSize * 0.75}px;">${tag.trim()}</span>`).join('')}
          </div>` : ''}
          <p class="opacity-60" style="font-size: ${fontSize * 0.75}px; color: ${textColor};">${formattedDate}</p>
        `;
      }
      
      element.innerHTML = contentHTML;
      
      const deleteBtn = element.querySelector('.delete-btn');
      deleteBtn.onclick = () => deleteEntry(entry);

      const starBtn = element.querySelector('.star-btn');
      starBtn.onclick = async () => {
        const updatedEntry = { ...entry, is_favorite: !isFavorite };
        await window.dataSdk.update(updatedEntry);
      };
    }

    async function deleteEntry(entry) {
      const result = await window.dataSdk.delete(entry);
      
      if (!result.isOk) {
        showToast('Failed to delete entry. Please try again.');
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      const config = window.elementSdk ? window.elementSdk.config : notebookDefaultConfig;
      const primaryColor = config.primary_color || notebookDefaultConfig.primary_color;
      const surfaceColor = config.surface_color || notebookDefaultConfig.surface_color;
      const fontSize = config.font_size || notebookDefaultConfig.font_size;
      
      toast.textContent = message;
      toast.style.position = 'fixed';
      toast.style.bottom = '20px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.backgroundColor = primaryColor;
      toast.style.color = surfaceColor;
      toast.style.padding = '12px 24px';
      toast.style.borderRadius = '8px';
      toast.style.fontSize = `${fontSize * 0.9}px`;
      toast.style.zIndex = '1000';
      toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    onConfigChange(notebookDefaultConfig);
    switchView('entries');
  
  </script>
</body>
</html>
